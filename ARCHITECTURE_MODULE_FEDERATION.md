# üèóÔ∏è OneMomentSuperApp: –ê–†–•–ò–¢–ï–ö–¢–£–†–ê MODULE FEDERATION
> **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–ª—è 81 —ç–∫—Ä–∞–Ω–∞**
> **–í–µ—Ä—Å–∏—è:** 1.0 | **–î–∞—Ç–∞:** 20.09.2025

## üì¶ –û–°–ù–û–í–ù–ê–Ø –ö–û–ù–¶–ï–ü–¶–ò–Ø

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           OneMoment Host App (5MB)          ‚îÇ
‚îÇ                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ        Core Shell & Navigation       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                     ‚Üì                        ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ     Module Federation Runtime        ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üì
    –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
                     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Restaurant  ‚îÇ    Hotel    ‚îÇ Translator  ‚îÇ    eSIM     ‚îÇ
‚îÇ   Module    ‚îÇ   Module    ‚îÇ   Module    ‚îÇ   Module    ‚îÇ
‚îÇ    (2MB)    ‚îÇ    (2MB)    ‚îÇ    (1MB)    ‚îÇ    (1MB)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üéØ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø RE.PACK

### webpack.config.js
```javascript
const Repack = require('@callstack/repack');

module.exports = {
  entry: {
    app: './src/index.js',
  },
  plugins: [
    new Repack.plugins.ModuleFederationPluginV2({
      name: 'OneMomentHost',
      filename: 'remoteEntry.js',
      
      // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–ª—è —Å—É–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
      exposes: {
        './Navigation': './src/navigation/NavigationContainer',
        './Auth': './src/auth/AuthProvider',
        './UI': './src/shared/UIKit',
      },
      
      // –ü–æ–¥–∫–ª—é—á–∞–µ–º —É–¥–∞–ª—ë–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
      remotes: {
        restaurants: {
          external: `promise new Promise(resolve => {
            const script = loadScript('https://cdn.onemoment.app/restaurants/[version]/remoteEntry.js');
            script.onload = () => {
              resolve(window.restaurants);
            };
          })`,
        },
        hotels: {
          external: `promise new Promise(resolve => {
            const script = loadScript('https://cdn.onemoment.app/hotels/[version]/remoteEntry.js');
            script.onload = () => {
              resolve(window.hotels);
            };
          })`,
        },
        translator: {
          external: `promise new Promise(resolve => {
            const script = loadScript('https://cdn.onemoment.app/translator/[version]/remoteEntry.js');
            script.onload = () => {
              resolve(window.translator);
            };
          })`,
        },
        esim: {
          external: `promise new Promise(resolve => {
            const script = loadScript('https://cdn.onemoment.app/esim/[version]/remoteEntry.js');
            script.onload = () => {
              resolve(window.esim);
            };
          })`,
        },
      },
      
      // –û–±—â–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
      shared: {
        'react': { 
          singleton: true, 
          eager: true,
          requiredVersion: '^18.2.0'
        },
        'react-native': { 
          singleton: true, 
          eager: true,
          requiredVersion: '^0.72.0'
        },
        '@apollo/client': {
          singleton: true,
          requiredVersion: '^3.8.0'
        },
        'zustand': {
          singleton: true,
          requiredVersion: '^4.4.0'
        },
      },
    }),
  ],
};
```

## üì± –°–¢–†–£–ö–¢–£–†–ê –ú–û–î–£–õ–ï–ô

### Restaurant Module (28 —ç–∫—Ä–∞–Ω–æ–≤)
```javascript
// restaurants/webpack.config.js
module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'restaurants',
      filename: 'remoteEntry.js',
      exposes: {
        './QRScanner': './src/screens/QRScanner',
        './MenuCategories': './src/screens/MenuCategories',
        './Cart': './src/screens/Cart',
        './Payment': './src/screens/Payment',
        // ... –≤—Å–µ 28 —ç–∫—Ä–∞–Ω–æ–≤
      },
      shared: {
        ...sharedDependencies,
      },
    }),
  ],
};
```

### Hotel Module (10 —ç–∫—Ä–∞–Ω–æ–≤)
```javascript
// hotels/webpack.config.js  
module.exports = {
  plugins: [
    new ModuleFederationPlugin({
      name: 'hotels',
      filename: 'remoteEntry.js',
      exposes: {
        './HotelSearch': './src/screens/HotelSearch',
        './RoomSelection': './src/screens/RoomSelection',
        './DigitalCheckin': './src/screens/DigitalCheckin',
        // ... –≤—Å–µ 10 —ç–∫—Ä–∞–Ω–æ–≤
      },
    }),
  ],
};
```

## üîÑ –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ê–Ø –ó–ê–ì–†–£–ó–ö–ê

### ModuleLoader Component
```typescript
import React, { Suspense, lazy, useState, useEffect } from 'react';
import { View, Text, ActivityIndicator } from 'react-native';

interface ModuleLoaderProps {
  moduleName: 'restaurants' | 'hotels' | 'translator' | 'esim';
  screenName: string;
  fallback?: React.ComponentType;
}

export const ModuleLoader: React.FC<ModuleLoaderProps> = ({
  moduleName,
  screenName,
  fallback: Fallback,
}) => {
  const [Module, setModule] = useState<React.ComponentType | null>(null);
  const [error, setError] = useState<Error | null>(null);
  
  useEffect(() => {
    const loadModule = async () => {
      try {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
        const cached = await AsyncStorage.getItem(`module_${moduleName}`);
        if (cached) {
          const CachedModule = JSON.parse(cached);
          setModule(() => CachedModule);
          return;
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª—å
        const container = await import(moduleName);
        const factory = await container.get(`./${screenName}`);
        const Module = factory();
        
        // –ö—ç—à–∏—Ä—É–µ–º
        await AsyncStorage.setItem(
          `module_${moduleName}`,
          JSON.stringify(Module)
        );
        
        setModule(() => Module);
      } catch (err) {
        setError(err as Error);
        
        // Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
        if (Fallback) {
          setModule(() => Fallback);
        }
      }
    };
    
    loadModule();
  }, [moduleName, screenName]);
  
  if (error && !Fallback) {
    return <ErrorBoundary error={error} />;
  }
  
  if (!Module) {
    return <LoadingScreen />;
  }
  
  return (
    <Suspense fallback={<LoadingScreen />}>
      <Module />
    </Suspense>
  );
};
```

## üé® –ù–ê–í–ò–ì–ê–¶–ò–Ø –ú–ï–ñ–î–£ –ú–û–î–£–õ–Ø–ú–ò

### Navigation Setup
```typescript
import { NavigationContainer } from '@react-navigation/native';
import { createNativeStackNavigator } from '@react-navigation/native-stack';

const Stack = createNativeStackNavigator();

export const AppNavigator = () => {
  return (
    <NavigationContainer>
      <Stack.Navigator>
        {/* Core Screens */}
        <Stack.Screen name="Home" component={HomeScreen} />
        <Stack.Screen name="Auth" component={AuthScreens} />
        
        {/* Restaurant Module */}
        <Stack.Screen 
          name="RestaurantQR"
          component={() => (
            <ModuleLoader 
              moduleName="restaurants" 
              screenName="QRScanner"
            />
          )}
        />
        
        {/* Hotel Module */}
        <Stack.Screen
          name="HotelSearch"
          component={() => (
            <ModuleLoader
              moduleName="hotels"
              screenName="HotelSearch"  
            />
          )}
        />
        
        {/* Translator Module */}
        <Stack.Screen
          name="Translator"
          component={() => (
            <ModuleLoader
              moduleName="translator"
              screenName="VoiceTranslator"
            />
          )}
        />
        
        {/* eSIM Module */}
        <Stack.Screen
          name="eSIM"
          component={() => (
            <ModuleLoader
              moduleName="esim"
              screenName="eSIMMarketplace"
            />
          )}
        />
      </Stack.Navigator>
    </NavigationContainer>
  );
};
```

## üìä –í–ï–†–°–ò–û–ù–ò–†–û–í–ê–ù–ò–ï –ú–û–î–£–õ–ï–ô

### Version Management
```typescript
interface ModuleVersion {
  module: string;
  version: string;
  minVersion: string;
  releaseDate: Date;
  features: string[];
}

const MODULE_VERSIONS: ModuleVersion[] = [
  {
    module: 'restaurants',
    version: '1.2.0',
    minVersion: '1.0.0',
    releaseDate: new Date('2025-09-01'),
    features: ['QR', 'TON', 'Reviews']
  },
  {
    module: 'hotels',
    version: '1.1.0',
    minVersion: '1.0.0',
    releaseDate: new Date('2025-09-10'),
    features: ['Booking', 'DigitalKey']
  },
  // ...
];

// A/B Testing —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π
const getModuleVersion = (module: string, userId: string): string => {
  const hash = hashCode(userId);
  
  // 10% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–ª—É—á–∞—é—Ç beta –≤–µ—Ä—Å–∏—é
  if (hash % 10 === 0) {
    return `${module}@beta`;
  }
  
  // 90% –ø–æ–ª—É—á–∞—é—Ç stable
  return `${module}@stable`;
};
```

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### Security Measures
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –º–æ–¥—É–ª–µ–π
const verifyModuleSignature = async (
  moduleUrl: string,
  signature: string
): Promise<boolean> => {
  const publicKey = await getPublicKey();
  const moduleContent = await fetch(moduleUrl).then(r => r.text());
  
  return crypto.subtle.verify(
    'RSA-SHA256',
    publicKey,
    signature,
    moduleContent
  );
};

// Sandbox –¥–ª—è –º–æ–¥—É–ª–µ–π
const createModuleSandbox = (moduleCode: string) => {
  return new Function(
    'window',
    'document',
    'require',
    `
      'use strict';
      const sandbox = Object.create(null);
      ${moduleCode}
      return sandbox.exports;
    `
  )({}, {}, secureRequire);
};
```

## üìà –ú–ï–¢–†–ò–ö–ò –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì

### Performance Tracking
```typescript
interface ModuleMetrics {
  loadTime: number;
  bundleSize: number;
  cacheHitRate: number;
  errorRate: number;
  userEngagement: number;
}

const trackModulePerformance = (
  moduleName: string,
  metrics: ModuleMetrics
): void => {
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫—É
  analytics.track('module_performance', {
    module: moduleName,
    ...metrics,
  });
  
  // –ê–ª–µ—Ä—Ç –µ—Å–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–æ
  if (metrics.loadTime > 3000) {
    Sentry.captureMessage(
      `Slow module load: ${moduleName} (${metrics.loadTime}ms)`
    );
  }
};
```

## üöÄ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞
```typescript
// –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –º–æ–¥—É–ª–∏
const preloadModules = async () => {
  const popularModules = ['restaurants', 'hotels'];
  
  for (const module of popularModules) {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ —Ñ–æ–Ω–µ
    requestIdleCallback(() => {
      import(module).then(container => {
        // –ö—ç—à–∏—Ä—É–µ–º
        cacheModule(module, container);
      });
    });
  }
};
```

### Chunk Splitting
```javascript
// –†–∞–∑–¥–µ–ª—è–µ–º –±–æ–ª—å—à–∏–µ –º–æ–¥—É–ª–∏ –Ω–∞ —á–∞–Ω–∫–∏
optimization: {
  splitChunks: {
    chunks: 'async',
    minSize: 20000,
    maxSize: 244000,
    cacheGroups: {
      restaurant: {
        test: /[\\/]restaurants[\\/]/,
        name: 'restaurant-vendor',
        priority: 10,
      },
      hotel: {
        test: /[\\/]hotels[\\/]/,
        name: 'hotel-vendor',
        priority: 10,
      },
    },
  },
}
```

## ‚úÖ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ê–†–•–ò–¢–ï–ö–¢–£–†–´

1. **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ** - –æ–±–Ω–æ–≤–ª—è–µ–º –º–æ–¥—É–ª–∏ –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏
2. **–ú–∞–ª—ã–π —Ä–∞–∑–º–µ—Ä** - –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ
3. **A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
4. **Fallback** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ CDN –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥—É–ª–∏

---

**üìå –≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ—Ä–∂–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥ 20MB –ø—Ä–∏ 81 —ç–∫—Ä–∞–Ω–µ!**